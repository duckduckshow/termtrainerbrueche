<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Termtrainer – Bruchterme</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.8em; margin:15px; }
  .frac {
    display:inline-block;
    text-align:center;
    vertical-align:middle;
    margin:0 4px;
  }
  .num { border-bottom:2px solid #000; display:block; line-height:1.1; }
  .den { display:block; line-height:1.1; }
  .result { font-size:1.3em; margin:10px; font-weight:bold; }
  .score { font-size:1em; margin:8px; color:#333; }
  input[type=text] {
    padding:8px;
    font-size:1.2em;
    width:120px;
    text-align:center;
    border-radius:8px;
    border:1px solid #aaa;
    margin:4px;
  }
  /* ---- Bruch-Eingabefelder ---- */
/* ---- Bruch-Eingabefelder: direkt zusammenstoßend ---- */
/* ---- Bruch-Eingabefelder: ohne jeden Abstand ---- */
.fractionField {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  vertical-align: middle;
  margin: 0 6px;
  line-height: 0;            /* verhindert vertikale Lücken */
}

.fractionField .numInput,
.fractionField .denInput {
  width: 80px;
  text-align: center;
  font-size: 1.1em;
  border: 1px solid #aaa;
  border-radius: 0;
  background: white;
  padding: 6px 8px;
  margin: 0;
  display: block;
  line-height: 1;
}

.fractionField .numInput {
  border-bottom: 2px solid #000;  /* echter Bruchstrich */
}

.fractionField .denInput {
  border-top: none;              /* kein Doppelrand */
  position: relative;
  top: -1px;                     /* hebt den Nenner leicht an → bündig */
}




  button {
    background:#007bff;
    color:white;
    border:none;
    padding:10px 18px;
    margin:6px;
    font-size:1em;
    border-radius:8px;
    cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>

<h1>Termtrainer – Bruchterme</h1>
<div class="score" id="score">Aufgabe 1 von 10 – Punkte: 0</div>
<div id="task">Lade Aufgabe...</div>

<div id="inputArea"></div>

<br>
<button id="checkBtn">Prüfen</button>
<button id="newBtn">Neue Aufgabe</button>
<p class="result" id="result"></p>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const randomInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const sign=()=>Math.random()<0.5?"+":"-";
  const coeff=()=>randomInt(2,6);
  const gcd=(a,b)=>b===0?Math.abs(a):gcd(b,a%b);
  const simplify=s=>s.replace(/\s+/g,"").replace(/--/g,"+").replace(/\+-/g,"-").replace(/\b1(?=[a-zA-Z])/g,"").toLowerCase();

  const formatFractions = expr =>
    expr
      .replace(/\(([^)]+)\)\/(\d+)/g,(_,num,den)=>`<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`)
      .replace(/(\d+[a-z]*)\/(\d+)/g,(_,num,den)=>`<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`);

function isEquivalent(a, b) {
  const clean = s => simplify(s)
    .replace(/\s+/g, "")
    .replace(/\+0/g, "")
    .replace(/0\+/g, "")
    .replace(/([a-z])\+/g, "$1 + ")
    .replace(/\+([a-z])/g, " + $1")
    .replace(/\+-/g, "-")
    .replace(/--/g, "+")
    .replace(/\b1(?=[a-z])/g, "")
    .toLowerCase();

  const A = clean(a);
  const B = clean(b);

  // prüfe auf gleiche Terme mit vertauschter Reihenfolge (z. B. a/2+5 == 5+a/2)
  const sortTerms = s => s.split(/(?=[+-])/).map(x => x.trim()).sort().join("");
  return A === B || sortTerms(A) === sortTerms(B);
}


  const task=document.getElementById("task"),
        result=document.getElementById("result"),
        score=document.getElementById("score"),
        checkBtn=document.getElementById("checkBtn"),
        newBtn=document.getElementById("newBtn"),
        inputArea=document.getElementById("inputArea");

  let sol="", points=0, round=1, total=10;

  /* --------------------- Aufgaben-Generator --------------------- */
 function createTask() {
  const VAR = Math.random() < 0.5 ? "a" : "b";
  const t = Math.random();
  let aufgabe = "", solution = "";

  // Hilfsfunktionen
  const denomSet = [2, 3, 4, 5];
  const denom = denomSet[randomInt(0, denomSet.length - 1)];
  const c1 = coeff(), c2 = coeff();
  const g = gcd(c1 + c2, denom);

  // 1) Zwei Brüche addieren
  if (t < 0.18) {
    aufgabe = `(${c1}${VAR})/${denom} + (${c2}${VAR})/${denom}`;
    const num = c1 + c2, d = denom / gcd(num, denom);
    const n = num / gcd(num, denom);
    solution = d === 1 ? `${n}${VAR}` : `${n}${VAR}/${d}`;
  }

  // 2) Zwei Brüche subtrahieren
  else if (t < 0.34) {
    const c1s = randomInt(3, 8);
    const c2s = randomInt(1, c1s - 1);
    const denom2 = denomSet[randomInt(0, denomSet.length - 1)];
    aufgabe = `(${c1s}${VAR})/${denom2} - (${c2s}${VAR})/${denom2}`;
    const num = c1s - c2s;
    const g2 = gcd(num, denom2);
    const nK = num / g2, dK = denom2 / g2;
    solution = dK === 1 ? `${nK}${VAR}` : `${nK}${VAR}/${dK}`;
  }

  // 3) Gemischter Term mit Teilung
  else if (t < 0.5) {
    const c = coeff(), n = randomInt(2, 6);
    const denom3 = denomSet[randomInt(0, denomSet.length - 1)];
    aufgabe = `(${c}${VAR} + ${n * denom3})/${denom3}`;
    const c2 = c / denom3;
    if (Number.isInteger(c2)) {
      solution = `${c2}${VAR} + ${n}`;
    } else {
      const g3 = gcd(c, denom3);
      solution = `(${c / g3}${VAR})/${denom3 / g3} + ${n}`;
    }
  }

  // 4) Bruch * Zahl
  else if (t < 0.66) {
    const denom4 = denomSet[randomInt(0, denomSet.length - 1)];
    const factor = randomInt(2, 4);
    const c = coeff();
    aufgabe = `(${c}${VAR})/${denom4} × ${factor}`;
    const num = c * factor;
    const g4 = gcd(num, denom4);
    const nK = num / g4, dK = denom4 / g4;
    solution = dK === 1 ? `${nK}${VAR}` : `${nK}${VAR}/${dK}`;
  }

  // 5) Bruch ÷ Zahl
  else if (t < 0.82) {
    const denom5 = denomSet[randomInt(0, denomSet.length - 1)];
    const div = randomInt(2, 4);
    const c = coeff();
    aufgabe = `(${c}${VAR})/${denom5} ÷ ${div}`;
    const newDen = denom5 * div;
    const g5 = gcd(c, newDen);
    const nK = c / g5, dK = newDen / g5;
    solution = dK === 1 ? `${nK}${VAR}` : `${nK}${VAR}/${dK}`;
  }

  // 6) Kürzbarer Zähler mit Summe
  else {
    const c = randomInt(2, 4);
    const n = randomInt(2, 5);
    const denom6 = c * randomInt(2, 3); // garantiert kürzbar
    aufgabe = `(${c}${VAR} + ${n * denom6})/${denom6}`;
    solution = `${VAR}/${denom6 / c} + ${n}`;
  }

  sol = simplify(solution);
  return aufgabe;
}


  /* --------------------- Eingabefelder erzeugen --------------------- */
  function showInputFieldsForSolution(solution) {
    inputArea.innerHTML = "";

    const hasFraction = solution.includes("/");
    if (!hasFraction) {
      // einfacher Term
      const simple = document.createElement("input");
      simple.type = "text";
      simple.id = "mainInput";
      inputArea.appendChild(simple);
      return;
    }

    // Bruch vorhanden:
    const parts = solution.split("+").map(p => p.trim());
    const isMixed = parts.length === 2;
    const isFracFirst = parts[0].includes("/");

    // Eingabeelement für Bruch:
    const frac = document.createElement("span");
    frac.className = "fractionField";
    frac.innerHTML = `
      <input type="text" class="numInput" id="numInput"><br>
      <input type="text" class="denInput" id="denInput">
    `;

    // Eingabeelement für normalen Term:
    const term = document.createElement("input");
    term.type = "text";
    term.id = "mainInput";

    // Kombination entsprechend der Lösung:
    if (!isMixed) {
      inputArea.appendChild(frac);
    } else if (isFracFirst) {
      inputArea.appendChild(frac);
      const plus = document.createElement("span");
      plus.textContent = " + ";
      inputArea.appendChild(plus);
      inputArea.appendChild(term);
    } else {
      inputArea.appendChild(term);
      const plus = document.createElement("span");
      plus.textContent = " + ";
      inputArea.appendChild(plus);
      inputArea.appendChild(frac);
    }
  }

  /* --------------------- Eingaben auslesen --------------------- */
  function collectUserInput(){
    const num=document.getElementById("numInput");
    const den=document.getElementById("denInput");
    const main=document.getElementById("mainInput");

    if(num && den && main){
      // gemischter Ausdruck
      const isFracFirst = sol.trim().startsWith("(") || sol.trim().match(/^[^+]*\//);
      if(isFracFirst){
        return simplify(num.value+"/"+den.value+"+"+main.value);
      } else {
        return simplify(main.value+"+"+num.value+"/"+den.value);
      }
    }
    else if(num && den){
      return simplify(num.value+"/"+den.value);
    }
    else {
      return simplify(document.getElementById("mainInput").value);
    }
  }

  /* --------------------- Ablauf --------------------- */
  function newTask(){
    if(round>total){
      task.textContent="🎉 Runde beendet!";
      result.style.color="green";
      result.textContent=`Endstand: ${points}/${total} Punkte.`;
      round=1;points=0;newBtn.textContent="Neue Runde";
      return;
    }
    const aufg=createTask();
    task.innerHTML=formatFractions(aufg)+" = ?";
    result.textContent="";
    showInputFieldsForSolution(sol);
    score.textContent=`Aufgabe ${round} von ${total} – Punkte: ${points}`;
  }

function check() {
  const inputNum = document.getElementById("numInput");
  const inputDen = document.getElementById("denInput");
  const inputMain = document.getElementById("mainInput");

  const clean = s => s?.replace(/\s+/g, "").toLowerCase();

  const solution = sol; // globale Variable mit richtiger Lösung
  const hasFrac = solution.includes("/");
  const hasPlus = solution.includes("+");
  let correct = false;

  if (!hasFrac) {
    // nur einfacher Term
    if (clean(inputMain?.value) === clean(solution)) correct = true;
  } else if (hasFrac && !hasPlus) {
    // reiner Bruch
    const [numSol, denSol] = solution.split("/");
    if (clean(inputNum?.value) === clean(numSol) && clean(inputDen?.value) === clean(denSol))
      correct = true;
  } else {
    // gemischter Ausdruck (Term + Bruch)
    const parts = solution.split("+").map(p => p.trim());
    const isFracFirst = parts[0].includes("/");

    if (isFracFirst) {
      const [numSol, denSol] = parts[0].split("/");
      const termSol = parts[1];
      if (
        clean(inputNum?.value) === clean(numSol) &&
        clean(inputDen?.value) === clean(denSol) &&
        clean(inputMain?.value) === clean(termSol)
      ) correct = true;
    } else {
      const termSol = parts[0];
      const [numSol, denSol] = parts[1].split("/");
      if (
        clean(inputNum?.value) === clean(numSol) &&
        clean(inputDen?.value) === clean(denSol) &&
        clean(inputMain?.value) === clean(termSol)
      ) correct = true;
    }
  }

  if (correct) {
    result.style.color = "green";
    result.textContent = "✅ Richtig!";
    points++;
  } else {
    result.style.color = "red";
    result.innerHTML = `❌ Falsch! Richtig: ${formatFractions(solution)}`;
  }

  round++;
  score.textContent = `Aufgabe ${Math.min(round, total)} von ${total} – Punkte: ${points}`;
}


  checkBtn.addEventListener("click",check);
  newBtn.addEventListener("click",newTask);
  newTask();
});
</script>
</body>
</html>






