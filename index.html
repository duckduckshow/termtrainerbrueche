<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Termtrainer ‚Äì Bruchterme</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.8em; margin:15px; }
  .frac {
    display:inline-block;
    text-align:center;
    vertical-align:middle;
    margin:0 4px;
  }
  .num { border-bottom:2px solid #000; display:block; line-height:1.1; }
  .den { display:block; line-height:1.1; }
  .result { font-size:1.3em; margin:10px; font-weight:bold; }
  .score { font-size:1em; margin:8px; color:#333; }
  input[type=text] {
    padding:8px;
    font-size:1.2em;
    width:120px;
    text-align:center;
    border-radius:8px;
    border:1px solid #aaa;
    margin:4px;
  }
  .frac-input {
    display:inline-block;
    vertical-align:middle;
    text-align:center;
  }
  .frac-input .numInput, .frac-input .denInput {
    width:80px;
  }
  .frac-input .numInput {
    border-bottom:2px solid #000;
    border-radius:0;
  }
  button {
    background:#007bff;
    color:white;
    border:none;
    padding:10px 18px;
    margin:6px;
    font-size:1em;
    border-radius:8px;
    cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>

<h1>Termtrainer ‚Äì Bruchterme</h1>
<div class="score" id="score">Aufgabe 1 von 10 ‚Äì Punkte: 0</div>
<div id="task">Lade Aufgabe...</div>

<div id="inputArea"></div>

<br>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>
<p class="result" id="result"></p>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const randomInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const sign=()=>Math.random()<0.5?"+":"-";
  const coeff=()=>randomInt(2,6);
  const gcd=(a,b)=>b===0?Math.abs(a):gcd(b,a%b);
  const simplify=s=>s.replace(/\s+/g,"").replace(/--/g,"+").replace(/\+-/g,"-").replace(/\b1(?=[a-zA-Z])/g,"").toLowerCase();

  const formatFractions = expr => 
    expr.replace(/\(([^)]+)\)\/(\d+)/g,(_,num,den)=>`<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`)
         .replace(/(\d+[a-z]*)\/(\d+)/g,(_,num,den)=>`<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`);

  function isEquivalent(a,b){
    const normalize=expr=>simplify(expr).split(/(?=[+-])/).sort().join("");
    return normalize(a)===normalize(b);
  }

  const task=document.getElementById("task"),
        result=document.getElementById("result"),
        score=document.getElementById("score"),
        checkBtn=document.getElementById("checkBtn"),
        newBtn=document.getElementById("newBtn"),
        inputArea=document.getElementById("inputArea");

  let sol="", points=0, round=1, total=10;

  function createTask(){
    const VAR=Math.random()<0.5?"a":"b";
    const t=Math.random();
    let aufgabe="", solution="";

    if(t<0.4){
      const c1=coeff(), c2=coeff();
      const denom=[2,3,4,5][randomInt(0,3)];
      aufgabe=`(${c1}${VAR})/${denom} + (${c2}${VAR})/${denom}`;
      const num=c1+c2, g=gcd(num,denom);
      const nK=num/g, dK=denom/g;
      solution = dK===1 ? `${nK}${VAR}` : `${nK}${VAR}/${dK}`;
    }
    else if(t<0.7){
      const c1=randomInt(3,6), c2=randomInt(2,c1-1);
      const denom=[2,3,4][randomInt(0,2)];
      aufgabe=`(${c1}${VAR})/${denom} - (${c2}${VAR})/${denom}`;
      const num=c1-c2, g=gcd(num,denom);
      const nK=num/g, dK=denom/g;
      solution = dK===1 ? `${nK}${VAR}` : `${nK}${VAR}/${dK}`;
    }
    else {
      const c=coeff(), n=randomInt(2,6);
      const denom=[2,3,4][randomInt(0,2)];
      aufgabe=`(${c}${VAR} + ${n*denom})/${denom}`;
      const c2=c/denom, n2=n;
      if(Number.isInteger(c2))
        solution=`${c2}${VAR} + ${n2}`;
      else {
        const g=gcd(c,denom);
        solution=`(${c/g}${VAR})/${denom/g} + ${n}`;
      }
    }

    sol=simplify(solution);
    return aufgabe;
  }

 function showInputFieldsForSolution(solution) {
  inputArea.innerHTML = "";

  const hasFraction = solution.includes("/");
  const hasPlus = solution.includes("+");

  if (!hasFraction) {
    // nur ein einfacher Term (z. B. 3a + 2)
    const simple = document.createElement("input");
    simple.type = "text";
    simple.id = "mainInput";
    inputArea.appendChild(simple);
    return;
  }

  // Bruch vorhanden:
  const parts = solution.split("+").map(p => p.trim());
  const isMixed = parts.length === 2;
  const isFracFirst = parts[0].includes("/");

  // Eingabeelement f√ºr Bruch:
  const frac = document.createElement("span");
  frac.className = "fractionField";
  frac.innerHTML = `
    <input type="text" class="numInput" id="numInput"><br>
    <input type="text" class="denInput" id="denInput">
  `;

  // Eingabeelement f√ºr normalen Term:
  const term = document.createElement("input");
  term.type = "text";
  term.id = "mainInput";

  // Kombination entsprechend der L√∂sung:
  if (!isMixed) {
    // reiner Bruch (z. B. b/2)
    inputArea.appendChild(frac);
  } else if (isFracFirst) {
    // Bruch zuerst, dann Term (z. B. b/2 + 4)
    inputArea.appendChild(frac);
    const plus = document.createElement("span");
    plus.textContent = " + ";
    inputArea.appendChild(plus);
    inputArea.appendChild(term);
  } else {
    // Term zuerst, dann Bruch (z. B. 4 + b/2)
    inputArea.appendChild(term);
    const plus = document.createElement("span");
    plus.textContent = " + ";
    inputArea.appendChild(plus);
    inputArea.appendChild(frac);
  }
}

  function collectUserInput(){
    if(document.getElementById("numInput")){
      const num=document.getElementById("numInput").value.trim();
      const den=document.getElementById("denInput").value.trim();
      const main=document.getElementById("mainInput");
      if(main) return simplify(main.value+"+"+num+"/"+den);
      else return simplify(num+"/"+den);
    }
    return simplify(document.getElementById("mainInput").value);
  }

  function newTask(){
    if(round>total){
      task.textContent="üéâ Runde beendet!";
      result.style.color="green";
      result.textContent=`Endstand: ${points}/${total} Punkte.`;
      round=1;points=0;newBtn.textContent="Neue Runde";
      return;
    }
    const aufg=createTask();
    task.innerHTML=formatFractions(aufg)+" = ?";
    result.textContent="";
    showInputFieldsForSolution(sol);
    score.textContent=`Aufgabe ${round} von ${total} ‚Äì Punkte: ${points}`;
  }

  function check(){
    const input=collectUserInput();
    if(!input){result.style.color="gray";result.textContent="Bitte gib eine L√∂sung ein.";return;}
    if(isEquivalent(input,sol)){
      result.style.color="green";result.textContent="‚úÖ Richtig!";points++;
    } else {
      result.style.color="red";result.innerHTML=`‚ùå Falsch! Richtig: ${formatFractions(sol)}`;
    }
    round++;
    score.textContent=`Aufgabe ${Math.min(round,total)} von ${total} ‚Äì Punkte: ${points}`;
  }

  checkBtn.addEventListener("click",check);
  newBtn.addEventListener("click",newTask);
  newTask();
});
</script>
</body>
</html>

