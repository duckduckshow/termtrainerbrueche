<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Termtrainer â€“ Bruchterme</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.8em; margin:15px; }
  .frac {
    display: inline-block;
    text-align: center;
    vertical-align: middle;
    margin: 0 4px;
  }
  .num {
    border-bottom: 2px solid #000;
    display: block;
    line-height: 1.1;
    padding: 0 4px;
  }
  .den {
    display: block;
    line-height: 1.1;
  }
  .result { font-size:1.3em; margin:10px; font-weight:bold; }
  .score { font-size:1em; margin:8px; color:#333; }
  input {
    padding:10px;
    font-size:1.2em;
    width:80%;
    max-width:320px;
    text-align:center;
    border-radius:8px;
    border:1px solid #aaa;
    spellcheck:false;
  }
  button {
    background:#007bff;
    color:white;
    border:none;
    padding:10px 18px;
    margin:6px;
    font-size:1em;
    border-radius:8px;
    cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>

<h1>Termtrainer â€“ Bruchterme</h1>
<div class="score" id="score">Aufgabe 1 von 10 â€“ Punkte: 0</div>
<div id="task">Lade Aufgabe...</div>
<input type="text" id="answer" placeholder="Vereinfachter Term" autocomplete="off">
<br>
<button id="checkBtn">PrÃ¼fen</button>
<button id="newBtn">Neue Aufgabe</button>
<p class="result" id="result"></p>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const randomInt = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const sign = ()=>Math.random()<0.5?"+":"-";
  const coeff = ()=>randomInt(2,6);
  const gcd = (a,b)=>b===0?Math.abs(a):gcd(b,a%b);

  const simplify = s => s.replace(/\s+/g,"").replace(/--/g,"+").replace(/\+-/g,"-").replace(/\b1(?=[a-zA-Z])/g,"").toLowerCase();

  function formatFractions(expr) {
    // ersetzt (...) / Zahl durch waagrechten Bruch
    return expr.replace(/\(([^)]+)\)\/(\d+)/g, (_, num, den) => {
      return `<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`;
    }).replace(/(\d+[a-z]*)\/(\d+)/g, (_, num, den) => {
      return `<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`;
    });
  }

  function isEquivalent(a,b){
    const normalize=expr=>simplify(expr).split(/(?=[+-])/).sort().join("");
    return normalize(a)===normalize(b);
  }

  const task=document.getElementById("task"),
        result=document.getElementById("result"),
        score=document.getElementById("score"),
        answer=document.getElementById("answer"),
        checkBtn=document.getElementById("checkBtn"),
        newBtn=document.getElementById("newBtn");

  let sol="", points=0, round=1, total=10;

  function createTask(){
    const VAR=Math.random()<0.5?"a":"b";
    const t=Math.random();
    let aufgabe="", solution="";

    if(t<0.35){
      // (2a + 4)/2 â†’ a + 2
      const c=coeff(), n=randomInt(2,6);
      const denom=[2,3,4][randomInt(0,2)];
      aufgabe=`(${c}${VAR} + ${n*denom})/${denom}`;
      const c2=c/denom, n2=n;
      if(Number.isInteger(c2)) solution=`${c2}${VAR} + ${n2}`;
      else {
        const g=gcd(c,denom);
        solution=`(${c/g}${VAR})/${denom/g} + ${n}`;
      }
    }
    else if(t<0.55){
      // (5b)/3 + (3b)/3 â†’ 8b/3
      const c1=coeff(), c2=coeff();
      const denom=[2,3,4,5][randomInt(0,3)];
      aufgabe=`(${c1}${VAR})/${denom} + (${c2}${VAR})/${denom}`;
      const num=c1+c2, g=gcd(num,denom);
      const numK=num/g, denK=denom/g;
      if(denK===1) solution=`${numK}${VAR}`;
      else solution=`${numK}${VAR}/${denK}`;
    }
    else if(t<0.75){
      // (6a)/3 - (3a)/3 â†’ a
      const c1=randomInt(3,6), c2=randomInt(2,c1-1);
      const denom=[2,3,4,5][randomInt(0,3)];
      aufgabe=`(${c1}${VAR})/${denom} - (${c2}${VAR})/${denom}`;
      const num=c1-c2, g=gcd(num,denom);
      const numK=num/g, denK=denom/g;
      if(denK===1) solution=`${numK}${VAR}`;
      else solution=`${numK}${VAR}/${denK}`;
    }
    else{
      // (3a + 6)/3 Ã— 2 â†’ 2a + 4
      const c=coeff(), n=randomInt(2,6);
      const denom=[2,3,4][randomInt(0,2)];
      const factor=[2,3][randomInt(0,1)];
      aufgabe=`(${c*denom}${VAR} + ${n*denom})/${denom} Ã— ${factor}`;
      const numCoeff=c*factor, numConst=n*factor;
      solution=`${numCoeff}${VAR} + ${numConst}`;
    }

    sol=simplify(solution);
    return aufgabe;
  }

  function newTask(){
    if(round>total){
      task.textContent="ðŸŽ‰ Runde beendet!";
      result.style.color="green";
      result.textContent=`Endstand: ${points}/${total} Punkte.`;
      round=1;points=0;
      newBtn.textContent="Neue Runde";
      return;
    }
    const aufg=createTask();
    task.innerHTML=formatFractions(aufg)+" = ?";
    answer.value="";
    result.textContent="";
    score.textContent=`Aufgabe ${round} von ${total} â€“ Punkte: ${points}`;
  }

  function showSolution(solText){
    result.style.color="red";
    result.innerHTML=`âŒ Falsch! Richtig: ${formatFractions(solText)}`;
  }

  function check(){
    const input=simplify(answer.value);
    if(!input){result.style.color="gray";result.textContent="Bitte gib eine LÃ¶sung ein.";return;}
    if(isEquivalent(input,sol)){
      result.style.color="green";
      result.textContent="âœ… Richtig!";
      points++;
    } else {
      showSolution(sol);
    }
    round++;
    score.textContent=`Aufgabe ${Math.min(round,total)} von ${total} â€“ Punkte: ${points}`;
  }

  checkBtn.addEventListener("click",check);
  newBtn.addEventListener("click",newTask);
  answer.addEventListener("keydown",e=>{if(e.key==="Enter")check();});

  newTask();
});
</script>
</body>
</html>
