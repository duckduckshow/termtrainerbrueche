<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Termtrainer â€“ Bruchterme</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.8em; margin:15px; }
  .frac {
    display:inline-block;
    text-align:center;
    vertical-align:middle;
    line-height:1.1;
    margin:0 4px;
  }
  .num { border-bottom:2px solid #000; display:block; padding:2px 4px; }
  .den { display:block; padding:2px 4px; }
  .frac .frac { font-size:0.85em; } /* verschachtelte BrÃ¼che kleiner darstellen */

  .result { font-size:1.3em; margin:10px; font-weight:bold; }
  .score { font-size:1em; margin:8px; color:#333; }

  input[type=text] {
    padding:8px;
    font-size:1.2em;
    width:120px;
    text-align:center;
    border-radius:8px;
    border:1px solid #aaa;
    margin:4px;
  }

  /* ---- Bruch-Eingabefelder ---- */
  .fractionField {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    margin: 0 6px;
    line-height: 0;
  }

  .fractionField .numInput,
  .fractionField .denInput {
    width: 80px;
    text-align: center;
    font-size: 1.1em;
    border: 1px solid #aaa;
    border-radius: 0;
    background: white;
    padding: 6px 8px;
    margin: 0;
    display: block;
    line-height: 1;
  }

  .fractionField .numInput {
    border-bottom: 2px solid #000;
  }

  .fractionField .denInput {
    border-top: none;
    position: relative;
    top: -1px;
  }

  button {
    background:#007bff;
    color:white;
    border:none;
    padding:10px 18px;
    margin:6px;
    font-size:1em;
    border-radius:8px;
    cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>

<h1>Termtrainer â€“ Bruchterme</h1>
<div class="score" id="score">Aufgabe 1 von 10 â€“ Punkte: 0</div>
<div id="task">Lade Aufgabe...</div>

<div id="inputArea"></div>

<br>
<button id="checkBtn">PrÃ¼fen</button>
<button id="newBtn">Neue Aufgabe</button>
<p class="result" id="result"></p>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const randomInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const coeff=()=>randomInt(2,6);
  const gcd=(a,b)=>b===0?Math.abs(a):gcd(b,a%b);
  const simplify=s=>s.replace(/\s+/g,"").replace(/--/g,"+").replace(/\+-/g,"-").replace(/\b1(?=[a-zA-Z])/g,"").toLowerCase();

  /* ---------- Bruchformatierung (auch verschachtelt) ---------- */
  const formatFractions = expr => {
    // DoppelbrÃ¼che zuerst erkennen ((x)/y)/z oder ((x + ...)/y)/z
    expr = expr.replace(/\(\(([^)]+)\)\/(\d+)\)\/(\d+)/g, (_, inner, den1, den2) => {
      return `
        <span class="frac">
          <span class="num">
            <span class="frac">
              <span class="num">${inner}</span>
              <span class="den">${den1}</span>
            </span>
          </span>
          <span class="den">${den2}</span>
        </span>
      `;
    });

    // einfache BrÃ¼che mit Klammern
    expr = expr.replace(/\(([^)]+)\)\/(\d+)/g, (_, num, den) =>
      `<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`
    );

    // einfache BrÃ¼che ohne Klammern
    expr = expr.replace(/([0-9]*[a-z]*)\/(\d+)/g, (_, num, den) =>
      `<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`
    );

    return expr;
  };

  const task=document.getElementById("task"),
        result=document.getElementById("result"),
        score=document.getElementById("score"),
        checkBtn=document.getElementById("checkBtn"),
        newBtn=document.getElementById("newBtn"),
        inputArea=document.getElementById("inputArea");

  let sol="", points=0, round=1, total=10;

  /* ---------- Aufgaben-Generator ---------- */
  function createTask() {
    const VAR = Math.random() < 0.5 ? "a" : "b";
    const t = Math.random();
    let aufgabe = "", solution = "";

    const denomSet = [2,3,4,5];
    const denom = denomSet[randomInt(0, denomSet.length-1)];
    const c1 = coeff(), c2 = coeff();
    const gcd_ = (a,b)=>b===0?a:gcd_(b,a%b);

    if (t < 0.10) {
      aufgabe = `(${c1}${VAR})/${denom} + (${c2}${VAR})/${denom}`;
      const num = c1 + c2, g = gcd_(num,denom);
      solution = denom/g===1?`${num/g}${VAR}`:`${num/g}${VAR}/${denom/g}`;
    }
    else if (t < 0.20) {
      const c1s=randomInt(3,8), c2s=randomInt(1,c1s-1);
      const denom2=denomSet[randomInt(0,denomSet.length-1)];
      aufgabe=`(${c1s}${VAR})/${denom2} - (${c2s}${VAR})/${denom2}`;
      const num=c1s-c2s,g2=gcd_(num,denom2);
      solution=denom2/g2===1?`${num/g2}${VAR}`:`${num/g2}${VAR}/${denom2/g2}`;
    }
    else if (t < 0.30) {
      const c=coeff(), n=randomInt(2,6);
      const denom3=denomSet[randomInt(0,denomSet.length-1)];
      aufgabe=`(${c}${VAR} + ${n*denom3})/${denom3}`;
      const c2=c/denom3;
      if(Number.isInteger(c2)) solution=`${c2}${VAR} + ${n}`;
      else { const g3=gcd_(c,denom3); solution=`(${c/g3}${VAR})/${denom3/g3} + ${n}`; }
    }
    else if (t < 0.40) {
      const denom4=denomSet[randomInt(0,denomSet.length-1)];
      const factor=randomInt(2,4);
      const c=coeff();
      aufgabe=`(${c}${VAR})/${denom4} Ã— ${factor}`;
      const num=c*factor,g4=gcd_(num,denom4);
      solution=denom4/g4===1?`${num/g4}${VAR}`:`${num/g4}${VAR}/${denom4/g4}`;
    }
    else if (t < 0.50) {
      const denom5=denomSet[randomInt(0,denomSet.length-1)];
      const div=randomInt(2,4);
      const c=coeff();
      aufgabe=`(${c}${VAR})/${denom5} Ã· ${div}`;
      const newDen=denom5*div,g5=gcd_(c,newDen);
      solution=newDen/g5===1?`${c/g5}${VAR}`:`${c/g5}${VAR}/${newDen/g5}`;
    }
    else if (t < 0.60) {
      const c=randomInt(2,4);
      const n=randomInt(2,5);
      const denom6=c*randomInt(2,3);
      aufgabe=`(${c}${VAR} + ${n*denom6})/${denom6}`;
      solution=`${VAR}/${denom6/c} + ${n}`;
    }
    else if (t < 0.70) {
      const num1=coeff(),num2=coeff();
      const den1=denomSet[randomInt(0,denomSet.length-1)];
      const den2=denomSet[randomInt(0,denomSet.length-1)];
      aufgabe=`(${num1}${VAR})/${den1} Ã— (${num2})/${den2}`;
      const num=num1*num2, den=den1*den2, g=gcd_(num,den);
      solution=den/g===1?`${num/g}${VAR}`:`${num/g}${VAR}/${den/g}`;
    }
    else if (t < 0.80) {
      const k=randomInt(2,4);
      const a=coeff(), b=randomInt(1,6);
      const den=denomSet[randomInt(0,denomSet.length-1)];
      aufgabe=`${k} Ã— (${a}${VAR} + ${b})/${den}`;
      const num1=k*a, num2=k*b, g=gcd_(num1,den);
      const n1=num1/g,d1=den/g,n2=num2/g,d2=den/g;
      if (d1===1&&d2===1) solution=`${n1}${VAR} + ${n2}`;
      else if (d1===d2) solution=`(${n1}${VAR} + ${n2})/${d1}`;
      else solution=`${n1}${VAR}/${d1} + ${n2}/${d2}`;
    }
    else if (t < 0.90) {
      const n1=coeff(),n2=coeff(),n3=coeff();
      const den=[2,4][randomInt(0,1)];
      aufgabe=`(${n1}${VAR})/${den} + (${n2}${VAR})/${den} + (${n3}${VAR})/${den}`;
      const sum=n1+n2+n3,g=gcd_(sum,den);
      solution=den/g===1?`${sum/g}${VAR}`:`${sum/g}${VAR}/${den/g}`;
    }
    else {
      const innerNum=coeff();
      const innerDen=[2,3][randomInt(0,1)];
      const outerDen=[2,3][randomInt(0,1)];
      const plus=Math.random()<0.5?" + 1":"";
      aufgabe=`((${innerNum}${VAR})/${innerDen}${plus})/${outerDen}`;
      if (plus==="") {
        const num=innerNum,den=innerDen*outerDen,g=gcd_(num,den);
        solution=den/g===1?`${num/g}${VAR}`:`${num/g}${VAR}/${den/g}`;
      } else {
        const num=innerNum,den=innerDen*outerDen,g=gcd_(num,den);
        const nK=num/g,dK=den/g;
        solution=`${nK}${VAR}/${dK} + 1/${outerDen}`;
      }
    }

    sol=simplify(solution);
    return aufgabe;
  }

  /* ---------- Eingabefelder ---------- */
  function showInputFieldsForSolution(solution) {
    inputArea.innerHTML="";
    const hasFraction=solution.includes("/");
    if(!hasFraction){
      const simple=document.createElement("input");
      simple.type="text"; simple.id="mainInput";
      inputArea.appendChild(simple);
      return;
    }

    const parts=solution.split("+").map(p=>p.trim());
    const isMixed=parts.length===2;
    const isFracFirst=parts[0].includes("/");

    const frac=document.createElement("span");
    frac.className="fractionField";
    frac.innerHTML=`<input type="text" class="numInput" id="numInput"><br><input type="text" class="denInput" id="denInput">`;

    const term=document.createElement("input");
    term.type="text"; term.id="mainInput";

    if(!isMixed){ inputArea.appendChild(frac); }
    else if(isFracFirst){
      inputArea.appendChild(frac);
      const plus=document.createElement("span");
      plus.textContent=" + ";
      inputArea.appendChild(plus);
      inputArea.appendChild(term);
    } else {
      inputArea.appendChild(term);
      const plus=document.createElement("span");
      plus.textContent=" + ";
      inputArea.appendChild(plus);
      inputArea.appendChild(frac);
    }
  }

  /* ---------- Eingaben prÃ¼fen ---------- */
/* ---------- Eingaben prÃ¼fen ---------- */
function check() {
  const inputNum = document.getElementById("numInput");
  const inputDen = document.getElementById("denInput");
  const inputMain = document.getElementById("mainInput");

  // Vergleichsfunktion: bereinigt beide Seiten gleich
  function equalClean(a, b) {
    const normalize = s => (
      s
        ? s
            .replace(/\s+/g, "")      // Leerzeichen entfernen
            .replace(/\(\s*/g, "")    // Ã¼berflÃ¼ssige Klammern
            .replace(/\s*\)/g, "")
            .replace(/^(\+)?/, "")    // fÃ¼hrendes Plus entfernen
            .toLowerCase()
        : ""
    );
    return normalize(a) === normalize(b);
  }

  const solution = sol;
  const hasFrac = solution.includes("/");
  const hasPlus = solution.includes("+");
  let correct = false;

  if (!hasFrac) {
    // einfacher Term
    correct = equalClean(inputMain?.value, solution);
  }
  else if (hasFrac && !hasPlus) {
    // reiner Bruch
    const [numSol, denSol] = solution.split("/");
    if (equalClean(inputNum?.value, numSol) && equalClean(inputDen?.value, denSol))
      correct = true;
  }
  else {
    // gemischte Terme mit +
    const parts = solution.split(/\s*\+\s*/).map(p => p.trim());
    const isFracFirst = parts[0].includes("/");

    if (isFracFirst) {
      const [numSol, denSol] = parts[0].split("/");
      const termSol = parts[1];
      if (
        equalClean(inputNum?.value, numSol) &&
        equalClean(inputDen?.value, denSol) &&
        equalClean(inputMain?.value, termSol)
      ) correct = true;
    } else {
      const termSol = parts[0];
      const [numSol, denSol] = parts[1].split("/");
      if (
        equalClean(inputNum?.value, numSol) &&
        equalClean(inputDen?.value, denSol) &&
        equalClean(inputMain?.value, termSol)
      ) correct = true;
    }
  }

  if (correct) {
    result.style.color = "green";
    result.textContent = "âœ… Richtig!";
    points++;
  } else {
    result.style.color = "red";
    result.innerHTML = `âŒ Falsch! Richtig: ${formatFractions(solution)}`;
  }

  round++;
  score.textContent = `Aufgabe ${Math.min(round, total)} von ${total} â€“ Punkte: ${points}`;
}


  /* ---------- Neue Aufgabe ---------- */
  function newTask(){
    if(round>total){
      task.textContent="ðŸŽ‰ Runde beendet!";
      result.style.color="green";
      result.textContent=`Endstand: ${points}/${total} Punkte.`;
      round=1;points=0;newBtn.textContent="Neue Runde"; return;
    }
    const aufg=createTask();
    task.innerHTML=formatFractions(aufg)+" = ?";
    result.textContent="";
    showInputFieldsForSolution(sol);
    score.textContent=`Aufgabe ${round} von ${total} â€“ Punkte: ${points}`;
  }

  checkBtn.addEventListener("click",check);
  newBtn.addEventListener("click",newTask);
  newTask();
});
</script>
</body>
</html>


